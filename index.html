<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Corrientes</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://ricardozanini.github.io/favicon.ico">

    <link rel="stylesheet" type="text/css" href="//ricardozanini.github.io/themes/casper/assets/css/screen.css?v=1506599814057" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />

    <link rel="canonical" href="https://ricardozanini.github.io/" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Corrientes" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Corrientes" />
    <meta property="og:url" content="https://ricardozanini.github.io/" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Corrientes" />
    <meta name="twitter:url" content="https://ricardozanini.github.io/" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Corrientes",
    "url": "https://ricardozanini.github.io/"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Corrientes" href="https://ricardozanini.github.io/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">
    
        <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>
</head>
<body class="home-template nav-closed">

    

    <div class="site-wrapper">

        
<header class="main-header no-cover">
    <nav class="main-nav overlay clearfix">
        
    </nav>
    <div class="vertical">
        <div class="main-header-content inner">
            <h1 class="page-title">Corrientes</h1>
            <h2 class="page-description">101010</h2>
        </div>
    </div>
    <a class="scroll-down icon-arrow-left" href="#content" data-offset="-45"><span class="hidden">Scroll Down</span></a>
</header>

<main id="content" class="content" role="main">

    <div class="extra-pagination inner">
        <nav class="pagination" role="navigation">
        <span class="page-number">Page 1 of 1</span>
    </nav>
    
    </div>
    
    <article class="post tag-Ansible tag-Ansible-Galaxy">
        <header class="post-header">
            <h2 class="post-title"><a href="https://ricardozanini.github.io/2017/08/18/or-how-Ansible-Galaxy-can-short-your-way-to-awesomeness.html">How a developer could short their way on the Ansible learning</a></h2>
        </header>
        <section class="post-content">
            <div id="preamble">
    <div class="sectionbody">
    <div class="paragraph">
    <p>You&#8217;re a developer and gets starting feeling anxious to learn about Ansible (everybody is talking about it), but you barely know how to list a directory on a Linux machine! Don&#8217;t worry, you could use your developer skills to learn Ansible and starting doing some magic to build your way towards DevOps in a short time with a little help of Ansible Galaxy.</p>
    </div>
    <div class="paragraph">
    <p>So you&#8217;ve learned <a href="http://docs.ansible.com/ansible/latest/intro.html">all the basics of Ansible</a> and now are arguing yourself: where&#8217;s the patterns? How do I start using Ansible on a regular basis? How can I do this or that? I&#8217;m newbie on OS and I barely know where to start..</p>
    </div>
    <div class="paragraph">
    <p>I don&#8217;t know if I&#8217;ll provide the answers for all these questions, but I may help guide your way through it.</p>
    </div>
    <div class="paragraph">
    <p>Quoting from the <a href="https://galaxy.ansible.com/intro">official Ansible Galaxy&#8217;s documentation</a>:</p>
    </div>
    <div class="quoteblock">
    <blockquote>
    <div class="paragraph">
    <p>Ansible Galaxy is Ansible’s official community hub for sharing Ansible roles. A role is the Ansible way of bundling automation content and making it reusable.</p>
    </div>
    </blockquote>
    </div>
    <div class="paragraph">
    <p><strong>Reusable</strong>. That&#8217;s the word IT people always (or should) care about. Roles on Ansible is a great way to reuse a piece of task that you always have to do when provisioning some environment. I won&#8217;t extend myself here on how to create a role, for that please take a look on the <a href="http://docs.ansible.com/ansible/latest/playbooks_roles.html">official docs</a> that you should have your answers.</p>
    </div>
    <div class="paragraph">
    <p>Instead, I&#8217;d like to bring your attention on Ansible Galaxy and how you can reuse someone else&#8217;s work or contribute to it while learning something great. Galaxy is the <a href="https://hub.docker.com/">Docker Hub</a> for docker images or the Github for open source projects. There you&#8217;ll find a lot of roles people already did so you could take them and orchestrate your playbook on a way that it could do barely anything you need.</p>
    </div>
    <div class="paragraph">
    <p>So Ansible Galaxy can help you with: (a) learn by example by looking on the code other people already provided and; (b) create great playbooks by orchestrating with roles that have been done by the community.</p>
    </div>
    <div class="paragraph">
    <p>Let&#8217;s take a look on a <a href="https://bitbucket.org/tecnobizz/vagrant-alm">project I&#8217;m working on</a> that&#8217;s provisioning a environment to set up a sort of an <a href="https://en.wikipedia.org/wiki/Application_lifecycle_management">ALM process</a>. For that, I need to provision three servers: <a href="https://jenkins.io/">Jenkins</a> for CI/CD process, <a href="https://www.sonarsource.com/">SonarSource</a> for quality analysis and <a href="http://www.sonatype.org/nexus/">Nexus</a> for artifact repository.</p>
    </div>
    <div class="paragraph">
    <p>To provision all the three servers requires a lot of vanilla work that I, as an only enthusiast of Ansible and OS in general surely will take <strong>a lot</strong> of time to do so. And we don&#8217;t have that time, right? Take a deep breath, a couple of coffee and go along with me.</p>
    </div>
    </div>
    </div>
    <div class="sect2">
    <h3 id="_1_define_what_you_need_to_do">1) Define what you need to do</h3>
    <div class="paragraph">
    <p>First things first. Draw and write down everything you need to provision: a CentOS machine? Needs NodeJs? Java? PHP? What else? What are the application&#8217;s requirements? Try to be as detailed as you need to. Take your time to plan your way down the hill, so you&#8217;ll save time ahead.</p>
    </div>
    <div class="paragraph">
    <p>For this project, I just need the aforementioned 3 servers: Jenkins, SonarSource and Nexus on the latest version possible and, of course, everything that implies on it: a database server, JVM, web server and etc. Everything that I know that Ansible may provision for me.</p>
    </div>
    </div>
    <div class="sect2">
    <h3 id="_2_prepare_your_environment">2) Prepare your environment</h3>
    <div class="paragraph">
    <p>Start by <a href="http://docs.ansible.com/ansible/latest/intro_installation.html">installing Ansible</a>. After that, be sure that Ansible Galaxy is on your path by typing this on your console:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>$ ansible-galaxy --version</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>You should see an output like this:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>ansible-galaxy 2.3.1.0
    config file = /etc/ansible/ansible.cfg
    configured module search path = Default w/o overrides
    python version = 2.7.13 (default, Jun 26 2017, 10:20:05) [GCC 7.1.1 20170622 (Red Hat 7.1.1-3)]</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>Now configure your <code>ANSIBLE_ROLES_PATH</code>. This path is where Ansible Galaxy will save every role you install and where&#8217;s Ansible will look at when resolving the imports from your playbook. The <a href="http://docs.ansible.com/ansible/latest/galaxy.html#roles-path">default path</a> is <code>/etc/ansible/roles</code>. Make sure that the user who&#8217;s installing the roles have write permissions. If you are running on your own machine, make it yours:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>$ sudo chown -R myuser:myuser /etc/ansible/roles</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>Then you should work on a virtual machine environment. For that you could use <a href="http://docs.ansible.com/ansible/latest/guide_vagrant.html">Vagrant on top of libvirt</a>.</p>
    </div>
    <div class="paragraph">
    <p>And that&#8217;s it! You should have your environment set up. For more detailed information about the installation and configuration of Ansible Galaxy, please <a href="http://docs.ansible.com/ansible/latest/galaxy.html">check the docs</a>.</p>
    </div>
    </div>
    <div class="sect2">
    <h3 id="_3_looking_for_roles_that_you_need">3) Looking for roles that you need</h3>
    <div class="paragraph">
    <p>So now you have the plan for what you need to do and the Ansible Galaxy configured on your environment. Let&#8217;s search for the roles that we need to <strong>compose</strong> our playbook so we can provision all the three servers at once.</p>
    </div>
    <div class="paragraph">
    <p>Remember that you just need to bring all these roles from the Galaxy repository and run them on a orchestrate fashion to do what you need.</p>
    </div>
    <div class="paragraph">
    <p>You have at least three ways to search for roles:</p>
    </div>
    <div class="paragraph">
    <p>1 - <strong>Ansible Galaxy command line</strong>:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>$ ansible-galaxy search *jenkins*</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>You&#8217;ll see a list of roles with the name you provide as an argument. It&#8217;s a simple and fast way to look for a role, but not my preferable way. This list only provides the name and a short description for the role. This must be suffice if what you are looking for is not so popular. But like the example above, the result may return a lot of options. What to choose?</p>
    </div>
    <div class="paragraph">
    <p>2 - <strong>Ansible Galaxy Web UI Search</strong>.</p>
    </div>
    <div class="paragraph">
    <p>Go to <a href="https://galaxy.ansible.com/">the Ansible Galaxy web site</a> and start exploring or browsing for a role. Let&#8217;s use the same example as before and just search for Jenkins. Click on "Browse Roles" and type "Jenkins" on keyword (or just <a href="https://galaxy.ansible.com/list#/roles?page=1&amp;page_size=10&amp;autocomplete=jenkins">click here</a>). You&#8217;ll see a nice interface and a sort function that will make all the difference: <code>Stargazers</code>. That means we can filter by the most relevant and upvoted roles by the community. Prefer to take that one with the most starts. For this example, the chosen role will be the <a href="https://galaxy.ansible.com/geerlingguy/jenkins/">geerlingguy one</a>.</p>
    </div>
    <div class="paragraph">
    <p>3 - <strong>Google it</strong>.</p>
    </div>
    <div class="paragraph">
    <p>The mindset here is the same as #2, but now you may hit on the Github repository instead of on the Ansible Galaxy web site. Hint: it&#8217;s almost the same thing. Every Ansible Galaxy project has a Github backed project. So, guess what? It&#8217;s open and you can (and should) contribute to them.</p>
    </div>
    <div class="paragraph">
    <p>Now that we have our role(s) we can move forward and start using it.</p>
    </div>
    </div>
    <div class="sect2">
    <h3 id="_4_read_the_docs_explore_their_code">4) Read the docs, explore their code</h3>
    <div class="paragraph">
    <p>First things first. Read all available documentation on the project you choose and pay attention on the extension points. These normally are variables you should set to get the role do what you need. Take for example the <a href="https://github.com/geerlingguy/ansible-role-java">Geerling Guy&#8217;s Java role</a>.</p>
    </div>
    <div class="paragraph">
    <p>On this role you could set the Java version you want to be installed just by setting the <code>java_packages</code> variable.</p>
    </div>
    <div class="paragraph">
    <p>Go ahead and install the role on your machine:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>$ ansible-galaxy install geerlingguy.jenkins</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>You have to have internet connection so Ansible could connect on the repository and bring the role and all the dependencies it needs (maven, anyone?). After the installation process, check for the role installed on your system:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>$ ansible-galaxy list</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>You should see the Jenkins role installed on your system provided with the version and all the other dependencies it needs. Ansible Galaxy works like many others package managers over there: it downloads all other required dependencies so you can work with it without any worries. Remember the Ansible Role&#8217;s path set on step #2? Try to list the directory and you&#8217;ll see all the roles there too.</p>
    </div>
    <div class="paragraph">
    <p>Explore the role&#8217;s creator work by looking for what the role really do. Start by exploring the <code>$ANSIBLE_ROLES_PATH/roles/geerlingguy.jenkins/tasks/main.yml</code>. Normally this is the starting point of the role and you really could see what&#8217;s going on. Try to understand their code and how things are been doing there. It&#8217;s a very nice exercise to learn by example and to absorb concepts harder to get on books or manuals.</p>
    </div>
    <div class="paragraph">
    <p>After that, be comfortable with their code and explore everything else, trying to understand how the pieces are working together to make the role that awesome.</p>
    </div>
    </div>
    <div class="sect2">
    <h3 id="_5_test_it">5) Test it</h3>
    <div class="paragraph">
    <p>It&#8217;s time to enter in the arena and put some bytes to work for you. You have to create your project, so start small and on a directory, create a tree like this one:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>├── project.yml
    ├── group_vars
    │   ├── all.yml
    ├── inventory.ini
    ├── meta
    │   └── main.yml
    ├── requirements.yml</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>Let&#8217;s describe one by one:</p>
    </div>
    <div class="paragraph">
    <p>1 - <code>project.yml</code>: this will be the starting point of your project, so rename it as you pleased. To start using the role we&#8217;ve just installed, open the file and put this on it:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>- name: Deploy Jenkins CI
      hosts: jenkins_server
      remote_user: the_user
      become: yes
    
      roles:
        - geerlingguy.jenkins</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>We are creating a task to just run the role given it a name, defining a host and the user who will run the process on the target machine. Please note that is beyond of the scope of this post to create a container or a virtual machine where the Ansible will run. I suggest <a href="https://www.ansible.com/docker">Docker</a> or <a href="https://www.vagrantup.com/docs/provisioning/ansible.html">Vagrant</a> to do so.</p>
    </div>
    <div class="paragraph">
    <p>2 - <code>inventori.ini</code> is the file to list the machines Ansible will provision. Read more about it <a href="http://docs.ansible.com/ansible/latest/intro_inventory.html">here</a>. Remember that the <code>hosts</code> property described on #1 should match the host created on this file, for example:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>[jenkins_server]
    192.168.0.32</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>3 - <code>group_vars/all.yml</code>. Remember about the "role&#8217;s extension points" I mentioned on step #4? This file contains all the variables that we need to set to configure the role to do what we want. So, go ahead and define the java version for the Jenkins:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>java_packages:
      - java-1.8.0-openjdk</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>This variable is mentioned on <code>geerlingguy.java</code> role that is a dependency from <code>geerlingguy.jenkins</code>. Isn&#8217;t cool how roles can stick together to do great things?</p>
    </div>
    <div class="paragraph">
    <p>4 - <code>meta/main.yml</code>. On this file we are going to list all the dependencies we need from the roles:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>dependencies:
      - geerlingguy.jenkins</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>This way we can tell Ansible that we need this role to perform our tasks.</p>
    </div>
    <div class="paragraph">
    <p>5 - <code>requirements.yml</code>. Besides the name, this isn&#8217;t a required file for your project, but it&#8217;s very handy because we can list all Ansible Galaxy&#8217;s roles that we need and download then with just one command line:</p>
    </div>
    <div class="listingblock">
    <div class="content">
    <pre class="highlight"><code>$ ansible-galaxy -r requirements.xml</code></pre>
    </div>
    </div>
    <div class="paragraph">
    <p>Go ahead and start to provision. Your Jenkins server should be provisioned on your environment and you can start making CI/CD jobs.</p>
    </div>
    </div>
    <div class="sect2">
    <h3 id="_the_bottom_line">The Bottom Line</h3>
    <div class="paragraph">
    <p>Now it&#8217;s time to shine. Gather every role you could search for that you are going to use on your project and start chaining them together for awesomeness. In a short time you&#8217;ll be creating your own roles, contributing for the ones already on the community and do a great job on your own playbooks. Just to help you out, take a look <a href="https://bitbucket.org/tecnobizz/vagrant-alm">at this project</a> that I did to provision all the three servers for a ALM process I was talking about at the begining of this post. There I orchestrate a simple playbook to create all the three machines using just three tasks: provision Jenkins, Sonar Source and Nexus.</p>
    </div>
    <div class="paragraph">
    <p>See you next time.</p>
    </div>
    </div>
        </section>
        <footer class="post-meta">
            <img class="author-thumb" src="https://avatars3.githubusercontent.com/u/1538000?v&#x3D;4" alt="Ricardo Zanini" nopin="nopin" />
            <a href="https://ricardozanini.github.io/author/ricardozanini/">Ricardo Zanini</a>
             on <a href="https://ricardozanini.github.io/tag/Ansible/">Ansible</a>, <a href="https://ricardozanini.github.io/tag/Ansible-Galaxy/">Ansible_Galaxy</a>
            <time class="post-date" datetime="2017-08-18">18 August 2017</time>
        </footer>
    </article>
    
    <nav class="pagination" role="navigation">
        <span class="page-number">Page 1 of 1</span>
    </nav>
    

</main>


        <footer class="site-footer clearfix">
            <section class="copyright"><a href="https://ricardozanini.github.io">Corrientes</a> &copy; 2017</section>
            <section class="poweredby">Proudly published with <a href="http://hubpress.io">HubPress</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>

    <script type="text/javascript" src="//ricardozanini.github.io/themes/casper/assets/js/jquery.fitvids.js?v=1506599814057"></script>
    <script type="text/javascript" src="//ricardozanini.github.io/themes/casper/assets/js/index.js?v=1506599814057"></script>

</body>
</html>
